<!-- src/app/component/transfer-panel/transfer-panel.component.html -->
<div class="transfer-panel-wrapper card-style">

    <!-- "Add More" Actions -->
    <div class="add-more-actions" *ngIf="items.length === 0 && !isUploading">
        <button type="button" class="btn btn-add" (click)="addMoreFiles()">
            <i class="fas fa-file-circle-plus"></i> Add more files
        </button>
        <button type="button" class="btn btn-add" (click)="addFolder()">
            <i class="fas fa-folder-plus"></i> Add folders
        </button>
    </div>

    <!-- File Summary & List -->
    <div class="file-list-section" *ngIf="items.length > 0">
        <div class="file-summary">
            <span class="count">
                {{ totalCount }} file{{ totalCount !== 1 ? 's' : '' }}
                <ng-container *ngIf="!isUploading">({{ totalSize | byteFormat }})</ng-container>
            </span>
            <button *ngIf="items.length > 0 && !isUploading && !batchShareableLink" class="btn icon-btn btn-clear-all"
                title="Remove selection" (click)="clearAllItems()">
                <i class="fas fa-trash-alt"></i>
            </button>
            <button *ngIf="isUploading" class="btn icon-btn btn-cancel-upload" title="Cancel Upload"
                (click)="handleCancelUpload()">
                <i class="fas fa-times-circle"></i>
            </button>
        </div>

        <div class="file-list-scroll">
            <ul class="file-list">
                @for(item of items; track item.id) {
                <li class="file-list-item" [class.is-uploading-item]="isUploading">
                    <div class="item-icon"><i [ngClass]="item.icon"></i></div>
                    <div class="item-details">
                        <span class="item-name" [title]="item.name">{{ item.name }}</span>
                        <!-- Progress Details Text (shown during upload) -->
                        <div *ngIf="isUploading && !batchShareableLink" class="item-progress-text">
                            {{ currentUploadProgressSizeDisplay }} | {{ uploadPercentage.toFixed(0) }}% â€¢ {{
                            etaFormatted }}
                        </div>
                        <!-- Linear Progress Bar (shown during upload, visually part of the item) -->
                        <div *ngIf="isUploading && !batchShareableLink" class="item-linear-progress-bar-wrapper">
                            <div class="progress-bar-custom">
                                <div class="progress-bar-custom-fill" [style.width.%]="uploadPercentage"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Item Size (shown when NOT uploading) -->
                    <div *ngIf="!isUploading && !batchShareableLink" class="item-size">{{ item.size | byteFormat }}
                    </div>

                    <div class="item-actions">
                        <button *ngIf="!isUploading && !batchShareableLink" class="btn icon-btn btn-download-item"
                            title="Download this item (Local)" (click)="requestItemDownload(item, $event)">
                            <i class="fas fa-download"></i>
                        </button>
                        <button *ngIf="!isUploading && !batchShareableLink" class="btn icon-btn btn-remove-item"
                            title="Remove this item" (click)="requestItemRemoval(item, $event)">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </li>
                }
                @empty {
                <li class="empty-list">Select a file or folder to start</li>
                }
            </ul>
        </div>
    </div>

    <!-- Shareable Link Display -->
    <div *ngIf="batchShareableLink" class="share-link-display">
        <label>Your download link:</label>
        <div class="share-link-input-group">
            <input type="text" readonly [value]="batchShareableLink" title="Shareable download link">
            <button type="button" class="btn btn-secondary copy-button" (click)="copyLink(batchShareableLink, $event)"
                title="Copy link to clipboard">
                <i class="fas fa-copy"></i>Copy link
            </button>
            <div class="copy-success-tooltips-container">
                @for(tooltip of tooltips; track tooltip.id) {
                <div class="copy-success-tooltip">
                    {{ tooltip.message }}
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Upload Button Area -->
    <div class="panel-actions-upload" *ngIf="items.length > 0 && !isUploading && !batchShareableLink">
        <button class="btn btn-primary btn-upload-tg" (click)="startTransfer()">
            <i class="fab fa-telegram-plane"></i> Upload
        </button>
    </div>
</div>